# Casting loss

## Magnitudes

Simply using autocast (without changing anything) generates a loss of the order of `0.03`. 

The variation from using 50 samples, and then a different 50, is similar.

So that's a reasonable benchmark for 'trivial'.

## to torch.float8_e4m3fn

For Double Block s:

```
img_attn.proj, img_attn.qkv, img_mlp.0, img_mlp.2, img_mod.lin
txt_attn.proj, txt_attn.qkv, txt_mlp.0, txt_mlp.2, txt_mod.lin 
```

For Single Block s:

```
linear1, linear2, modulation.lin
```

Look deeper into:
- single block, especially later single blocks
- last double block (layer 18)



## In and final

- img_in
- time_in.in_layer
- time_in.out_layer
- vector_in.in_layer
- vector_in.out_layer
- guidance_in.in_layer
- guidance_in.out_layer
- txt_in
- final_layer.linear
- final_layer.adaLN_modulation.1

## Details

|layer|loss at torch.float8_e4m3fn|
|-|-|
|00|0.000896106939762830|
|01|0.01612972095608711|
|02|0.0260546281933784|
|03|0.003941180650144815|
|04|0.00400603422895073|
|05|0.00262426608242094|
|06|0.0026579929981380|
|07|0.003360746661201119|
|08|0.003302841447293758|
|09|0.00383317866362631|
|10|0.00478224223479628|
|11|0.004535338375717401|
|12|0.00553992763161659|
|13|0.00698138214647769|
|14|0.02303467690944671|
|15|0.01449442747980356|
|16|0.01411707233637571|
|17|0.0204088967293500|
|18|.inf|
|**|*** ^ Double ^ ***|
|**|*** V Single V ***|
|19|0.01884011738002300|
|20|0.01903399266302585|
|21|0.0331923551857471|
|22|0.0324994251132011|
|23|0.0421465709805488|
|24|0.0468857698142528|
|25|0.0729118809103965|
|26|0.1714585274457931|
|27|0.0850471034646034|
|28|0.1164838001132011|
|29|0.218304798007011|
|30|0.1407973319292068|
|31|0.1557329893112182|
|32|0.2381089180707931|
|33|0.21020507812|
|34|0.2187643647193908|
|35|0.30493164062|
|36|0.2145278006792068|
|37|0.1878590285778045|
|38|0.204101562|
|39|0.2108082473278045|
|40|0.1970502138137817|
|41|0.2569077312946319|
|42|0.287267357110977|
|43|0.284179687|
|44|0.408777564764022|
|45|0.443301916122436|
|46|0.534840285778045|
|47|0.49414062|
|48|0.4846909344196319|
|49|0.755572140216827|
|50|0.868738532066345|
|51|1.68554687|
|52|1.442555189132690|
|53|2.27711391448974|
|54|2.897518396377563|
|55|1.053653478622436|
|56|0.938534021377563|